---
- task:
    metadata:
      name: "Linux 64 (opt)"
      decription: "Linux 64 (opt)"

    payload:
      artifacts:
        public:
          type: directory
          path: /home/worker/artifacts
          expires: !from_now 24
      command:
        - "/bin/bash"
        - "-c"
        - "bin/checkout.sh && nss/automation/taskcluster/scripts/build.sh"
      env:
        NSS_ENABLE_TLS_1_3: 1
        GCC_VERSION: gcc-5
        GXX_VERSION: g++-5
        BUILD_OPT: 1
        USE_64: 1

    extra:
      treeherder:
        build:
          platform: linux64
        collection:
          opt: true
        symbol: B

  dependents:
    - cert
    - chains
    - cipher
    - crmf
    - db
    - ec
    - fips
    - gtests
    - lowhash
    - merge
    - ocsp
    - pkits
    - pkix
    - sdr
    - smime
    - ssl
    - tools

- task:
    metadata:
      name: "Linux 64 (opt, clang-3.8)"
      decription: "Linux 64 (opt, clang-3.8)"

    payload:
      command:
        - "/bin/bash"
        - "-c"
        - "bin/checkout.sh && nss/automation/taskcluster/scripts/build.sh"
      env:
        NSS_ENABLE_TLS_1_3: 1
        GCC_VERSION: clang-3.8
        GXX_VERSION: clang++-3.8
        BUILD_OPT: 1
        USE_64: 1

    extra:
      treeherder:
        build:
          platform: linux64
        collection:
          opt: true
        groupSymbol: Builds
        groupName: Various builds
        symbol: clang-3.8

- task:
    metadata:
      name: "Linux 64 (opt, gcc-4.8)"
      decription: "Linux 64 (opt, gcc-4.8)"

    payload:
      command:
        - "/bin/bash"
        - "-c"
        - "bin/checkout.sh && nss/automation/taskcluster/scripts/build.sh"
      env:
        NSS_ENABLE_TLS_1_3: 1
        GCC_VERSION: gcc-4.8
        GXX_VERSION: g++-4.8
        BUILD_OPT: 1
        USE_64: 1

    extra:
      treeherder:
        build:
          platform: linux64
        collection:
          opt: true
        groupSymbol: Builds
        groupName: Various builds
        symbol: gcc-4.8

- task:
    metadata:
      name: "Linux 64 (opt, gcc-6.1)"
      decription: "Linux 64 (opt, gcc-6.1)"

    payload:
      command:
        - "/bin/bash"
        - "-c"
        - "bin/checkout.sh && nss/automation/taskcluster/scripts/build.sh"
      env:
        NSS_ENABLE_TLS_1_3: 1
        GCC_VERSION: gcc-6
        GXX_VERSION: g++-6
        BUILD_OPT: 1
        USE_64: 1

    extra:
      treeherder:
        build:
          platform: linux64
        collection:
          opt: true
        groupSymbol: Builds
        groupName: Various builds
        symbol: gcc-6.1

- task:
    metadata:
      name: "Linux 64 (opt, NO_PKCS11_BYPASS=1)"
      decription: "Linux 64 (opt, NO_PKCS11_BYPASS=1)"

    payload:
      command:
        - "/bin/bash"
        - "-c"
        - "bin/checkout.sh && nss/automation/taskcluster/scripts/build.sh"
      env:
        NSS_ENABLE_TLS_1_3: 1
        NO_PKCS11_BYPASS: 1
        GCC_VERSION: gcc-5
        GXX_VERSION: g++-5
        BUILD_OPT: 1
        USE_64: 1

    extra:
      treeherder:
        build:
          platform: linux64
        collection:
          opt: true
        groupSymbol: Builds
        groupName: Various builds
        symbol: noPkcs11Bypass

- task:
    metadata:
      name: "Linux 64 (opt, no TLS 1.3)"
      decription: "Linux 64 (opt, no TLS 1.3)"

    payload:
      command:
        - "/bin/bash"
        - "-c"
        - "bin/checkout.sh && nss/automation/taskcluster/scripts/build.sh"
      env:
        GCC_VERSION: gcc-5
        GXX_VERSION: g++-5
        BUILD_OPT: 1
        USE_64: 1

    extra:
      treeherder:
        build:
          platform: linux64
        collection:
          opt: true
        groupSymbol: Builds
        groupName: Various builds
        symbol: noTLSv1.3
