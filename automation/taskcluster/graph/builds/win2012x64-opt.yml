---
- task:
    workerType: ttaubert-win2012r2

    metadata:
      name: "Windows 2012 64 (opt)"
      description: "Windows 2012 64 (opt)"

    payload:
      artifacts:
        - type: directory
          path: "public\\build"
          expires: !from_now 24
      command:
        - "time /t && hg clone -r %NSS_HEAD_REVISION% %NSS_HEAD_REPOSITORY% nss"
        - "time /t && bash -c nss/automation/taskcluster/windows/build.sh"
      env:
        PATH: "c:\\mozilla-build\\python;c:\\mozilla-build\\msys\\local\\bin;c:\\mozilla-build\\7zip;c:\\mozilla-build\\info-zip;c:\\mozilla-build\\python\\Scripts;c:\\mozilla-build\\yasm;c:\\mozilla-build\\msys\\bin;c:\\Windows\\system32;c:\\mozilla-build\\upx391w;c:\\mozilla-build\\moztools-x64\\bin;c:\\mozilla-build\\wget"
        NSS_ENABLE_TLS_1_3: "1"
        DOMSUF: localdomain
        HOST: localhost
        BUILD_OPT: "1"
        USE_64: "1"

    extra:
      treeherder:
        build:
          platform: windows2012-64
        collection:
          opt: true
        symbol: B
