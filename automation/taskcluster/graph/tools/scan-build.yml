---
- reruns: 0
  task:
    created: !from_now 0
    deadline: !from_now 24
    provisionerId: aws-provisioner-v1
    workerType: hg-worker
    schedulerId: task-graph-scheduler

    metadata:
      owner: !env TC_OWNER
      source: !env TC_SOURCE
      name: scan-build
      description: scan-build

    payload:
      maxRunTime: 3600
      image: ttaubert/nss-ci:0.0.17

      artifacts:
        public:
          type: directory
          path: /home/worker/artifacts
          expires: !from_now 24

      command:
        - "/bin/bash"
        - "-c"
        - "bin/checkout.sh && nss/automation/taskcluster/scripts/run_scan_build.sh"

      env:
        NSS_HEAD_REPOSITORY: !env NSS_HEAD_REPOSITORY
        NSS_HEAD_REVISION: !env NSS_HEAD_REVISION
        GCC_VERSION: clang
        GXX_VERSION: clang++
        NSS_ENABLE_TLS_1_3: 1
        USE_64: 1

    extra:
      treeherder:
        build:
          platform: nss-tools
        machine:
          platform: nss-tools
        symbol: scan-build-3.8
